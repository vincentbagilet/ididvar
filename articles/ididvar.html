<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>ididvar • ididvar</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Lato-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="ididvar">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ididvar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/ididvar.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/background.html">Background on the weights</a></li>
    <li><a class="dropdown-item" href="../articles/own-viz.html">Own visualizations</a></li>
    <li><a class="dropdown-item" href="../articles/specification.html">Specification and variation</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>ididvar</h1>
            
      

      <div class="d-none name"><code>ididvar.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentbagilet.github.io/ididvar/">ididvar</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/walkerke/tigris" class="external-link">tigris</a></span><span class="op">)</span></span></code></pre></div>
<p>The present vignette quickly <strong>presents a typical workflow for
analysis</strong>, using a very basic example. It also provides an
<strong>overview of most of <a href="docs/reference/index.html">the
functions</a> available</strong> in the package.</p>
<p>A more thorough example, with an actual analysis and interpretation
of the results, is available on the research project website.</p>
<div class="section level2">
<h2 id="overview-of-a-typical-workflow">Overview of a typical workflow<a class="anchor" aria-label="anchor" href="#overview-of-a-typical-workflow"></a>
</h2>
<p>The workflow to get a better understanding of observations of groups
of observations contributing to identification is relatively
straightforward:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Visualize the relationship</strong> between x and y after
partialling out (with the <code>idid_viz_bivar</code> function)</li>
<li>Compute the <strong>observation level weights</strong> and add a
<code>weight</code> variable to the data set (using
<code>idid_weights</code>)</li>
<li>
<strong>Visualize</strong> the distribution of these weights (the
cumulative with <code>idid_viz_cumul</code>, at the observation and
group level with <code>idid_viz_weights</code> or
<code>idid_viz_weights_map</code>. To <strong>identify groups</strong>
and variables for which there is a large heterogeneity in weights across
groups, use <code>idid_grouping_var</code>). At this stage, one might
already get a sense of the effective sample</li>
<li>Compute the set of <strong>identify contributing
observations</strong>, <em>ie</em> observations that we can drop without
too much altering the estimate (observations whose weight is larger than
a threshold computed with <code>idid_contrib_threshold</code>).</li>
<li>
<strong>Visualize contributing observations</strong>, both
individual and groups (using <code>idid_viz_contrib</code> and
<code>idid_viz_contrib_map</code>)</li>
<li>Compute and visualize the <strong>effective sample size</strong>
(with <code>idid_viz_drop_change</code> and
<code>idid_contrib_stats</code>)</li>
</ol>
<!-- Optionally, we can also add a `contrib` dummy. For that we need to determine the contribution threshold. Here I use the `idid_contrib_threshold` to find a weight threshold below which removing observations does not change the point estimate or the standard error of the estimate of interest by more than a given proportion. --><!-- 1. Compute the weights at a group level of interest (here state level) by summing weights of observations in this group. -->
</div>
<div class="section level2">
<h2 id="visualize-relationship">Visualize relationship<a class="anchor" aria-label="anchor" href="#visualize-relationship"></a>
</h2>
<p>Let’s assume we have already ran the regression of interest.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_ex</span> <span class="op">&lt;-</span> <span class="va">state.x77</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">state.x77</span><span class="op">)</span>,</span>
<span>    pop_quartiles <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html" class="external-link">cut_number</a></span><span class="op">(</span><span class="va">Population</span>, <span class="fl">4</span>, labels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    murder_quartiles <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html" class="external-link">cut_number</a></span><span class="op">(</span><span class="va">Murder</span>, <span class="fl">4</span>, labels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    income_quartiles <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html" class="external-link">cut_number</a></span><span class="op">(</span><span class="va">Income</span>, <span class="fl">4</span>, labels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span><span class="va">reg_ex</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_ex</span>,</span>
<span>            formula <span class="op">=</span> <span class="va">Illiteracy</span> <span class="op">~</span>  <span class="va">Income</span> <span class="op">+</span> <span class="va">Population</span> <span class="op">+</span> <span class="va">`Life Exp`</span> <span class="op">+</span> <span class="va">Frost</span><span class="op">)</span></span></code></pre></div>
<p>We first visualize the relationship between x and y (here
<code>Illiteracy</code> and <code>Income</code>) after partialling out
to understand what we are estimating and to visualize what is driving
our</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/idid_viz_bivar.html">idid_viz_bivar</a></span><span class="op">(</span><span class="va">reg_ex</span>, <span class="st">"Income"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ididvar_files/figure-html/idid_viz_bivar-1.png" width="2187.5"></p>
</div>
<div class="section level2">
<h2 id="compute-weights">Compute weights<a class="anchor" aria-label="anchor" href="#compute-weights"></a>
</h2>
<p>We can <strong>add the weights to the data</strong>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_ex_weights</span> <span class="op">&lt;-</span> <span class="va">data_ex</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="../reference/idid_weights.html">idid_weights</a></span><span class="op">(</span><span class="va">reg_ex</span>, <span class="st">"Income"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualize-the-weights">Visualize the weights<a class="anchor" aria-label="anchor" href="#visualize-the-weights"></a>
</h2>
<div class="section level3">
<h3 id="weights-distribution">Weights distribution<a class="anchor" aria-label="anchor" href="#weights-distribution"></a>
</h3>
<p>We can plot the distribution of weights using the
<code>idid_viz_cumul</code> function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/idid_viz_cumul.html">idid_viz_cumul</a></span><span class="op">(</span><span class="va">reg_ex</span>, <span class="st">"Income"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ididvar_files/figure-html/idid_viz_cumul-1.png" width="2187.5"></p>
<p>That allows us to analyse the extend to which the weights are evenly
distributed. A very unequal distribution should hint that some
observations contribute much more to identification and that some
observations may not contribute much.</p>
<p>We may then want to explore the distribution of weights along several
variables. Depending on the shape of the data, there might be some
obvious way to analyse it: if the data is an individual-time panel, one
may want to group it by individual and time. That can be done with, by
providing these two dimensions as the <code>var_x</code> and
<code>var_y</code> arguments.</p>
<p>When the data has a geographical dimension, one may want to plot a
map of the weights. The function <code>idid_viz_weights_map</code>
allows to do easily do that by only providing a shape file in a
<code>sf</code> format along with the join variable name.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">states_sf</span> <span class="op">&lt;-</span> <span class="fu">tigris</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tigris/man/states.html" class="external-link">states</a></span><span class="op">(</span></span>
<span>    cb <span class="op">=</span> <span class="cn">TRUE</span>, resolution <span class="op">=</span> <span class="st">"20m"</span>, year <span class="op">=</span> <span class="fl">2024</span>, progress_bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tigris</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tigris/man/shift_geometry.html" class="external-link">shift_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>state <span class="op">=</span> <span class="va">NAME</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/idid_viz_weights_map.html">idid_viz_weights_map</a></span><span class="op">(</span><span class="va">reg_ex</span>, <span class="st">"Income"</span>, <span class="va">states_sf</span>, <span class="st">"state"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ididvar_files/figure-html/idid_viz_weights_map-1.png" width="2187.5"></p>
<p>In addition–or instead–, it is often interesting to analyse whether
some groups have larger weights, <em>ie</em> contribute more, than
others. One may have <em>a priori</em> ideas regarding which variables
to group by. In cases when this might be less clear, one can use
<code>idid_grouping_var</code> to identify variables for which groups
created by each variable considered (in the <code>grouping_vars</code>
argument of the function) have the most between group variance in
weights, suggesting a large heterogeneity in weights across groups.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/idid_grouping_var.html">idid_grouping_var</a></span><span class="op">(</span></span>
<span>  <span class="va">reg_ex</span>, <span class="st">"Income"</span>, </span>
<span>  grouping_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"income_quartiles"</span>, <span class="st">"pop_quartiles"</span>, <span class="st">"murder_quartiles"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">grouping_var</th>
<th align="right">between_var</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">income_quartiles</td>
<td align="right">0.0536434</td>
</tr>
<tr class="even">
<td align="left">pop_quartiles</td>
<td align="right">0.0352604</td>
</tr>
<tr class="odd">
<td align="left">murder_quartiles</td>
<td align="right">0.0213752</td>
</tr>
</tbody>
</table>
<p>Here, the larges between group variance is across
<code>income_quartiles</code>, suggesting that some income group may
have larger weights than others. Now that dimensions along which it
makes sense to group the weights by have been identify, one can plot the
weights distribution across groups.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/idid_viz_weights.html">idid_viz_weights</a></span><span class="op">(</span><span class="va">reg_ex</span>, <span class="st">"Income"</span>, <span class="va">income_quartiles</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Income quartiles"</span>, </span>
<span>    title <span class="op">=</span> <span class="st">"Distribution of Identifying Variation Weights By Income"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"High income states contribute more to the estimation"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="ididvar_files/figure-html/idid_viz_weights-1.png" width="2187.5"></p>
<p>Through all these explorations, one can get a sense of the
distribution of weights, through space or groups.</p>
</div>
</div>
<div class="section level2">
<h2 id="contribution">Contribution<a class="anchor" aria-label="anchor" href="#contribution"></a>
</h2>
<p>The goal of the analysis is really to determine which observations
contribute to the estimation and which do not. The approach chosen to do
so here is to identify observations with low weight that can be dropped
without affecting the point estimate <em>and</em> standard errors by
more than a given proportion.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/idid_viz_drop_change.html">idid_viz_drop_change</a></span><span class="op">(</span></span>
<span>  <span class="va">reg_ex</span>, </span>
<span>  <span class="st">"Income"</span>, </span>
<span>  threshold_change <span class="op">=</span> <span class="fl">0.05</span>, <span class="co">#position of the dotted line</span></span>
<span>  search_end <span class="op">=</span> <span class="fl">0.4</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="ididvar_files/figure-html/idid_viz_drop_change-1.png" width="2187.5"></p>
<p>This function just loops over the <code>idid_drop_change</code>
function which, for a given proportion of observations dropped, computes
a variation of the point estimate and standard errors of the coefficient
of interest when dropping low weight observations.</p>
<p>Using the <code>idid_contrib_threshold</code> one can thus identify a
weight threshold below which removing observations does not change the
point estimate or the standard error of the estimate of interest by more
than a given proportion.</p>
<p>We can thus define an effective sample whose weights are below the
aforementioned threshold. We can then use the
<code>idid_contrib_stats</code> function to compute quick descriptive
statistics on this effective sample:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/idid_contrib_stats.html">idid_contrib_stats</a></span><span class="op">(</span><span class="va">reg_ex</span>, <span class="st">"Income"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Searching for the contribution threshold</span></span>
<span><span class="co">#&gt;   n_initial n_nominal n_effective prop_effective</span></span>
<span><span class="co">#&gt; 1        50        50          43           0.86</span></span></code></pre></div>
<p>The <code>ididvar</code> package also provides function to quickly
explore which observations are part of this effective sample.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/idid_viz_contrib.html">idid_viz_contrib</a></span><span class="op">(</span><span class="va">reg_ex</span>, <span class="st">"Income"</span>, <span class="va">income_quartiles</span><span class="op">)</span></span>
<span><span class="co">#&gt; Searching for the contribution threshold</span></span></code></pre></div>
<p><img src="ididvar_files/figure-html/unnamed-chunk-2-1.png" width="2187.5"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/idid_viz_contrib_map.html">idid_viz_contrib_map</a></span><span class="op">(</span><span class="va">reg_ex</span>, <span class="st">"Income"</span>, <span class="va">states_sf</span>, <span class="st">"state"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Searching for the contribution threshold</span></span></code></pre></div>
<p><img src="ididvar_files/figure-html/unnamed-chunk-2-2.png" width="2187.5"></p>
<p>provides a discussion and code to customize these graphs.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://vincentbagilet.github.io/" class="external-link">Vincent Bagilet</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
